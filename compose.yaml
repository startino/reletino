services:
  web:
    build:
      context: ./web
      dockerfile: ./.nixpacks/Dockerfile
      args:
        CI: "true"
        NIXPACKS_METADATA: "node"
        NODE_ENV: "production"
        NPM_CONFIG_PRODUCTION: "false"
    ports:
      - "5173:5173"
    volumes:
      - ./web:/app
    environment:
      - PUBLIC_CRITINO_API_URL="http://0.0.0.0:7531"
      - PUBLIC_CRITINO_API_KEY
      - PUBLIC_SUPABASE_URL
      - PUBLIC_SUPABASE_ANON_KEY
      - PRIVATE_SUPABASE_SERVICE_ROLE
      - PRIVATE_STRIPE_API_KEY
      - PUBLIC_API_URL
    env_file: ./web/.env
  api:
    build:
      context: ./services/api
      dockerfile: ./.nixpacks/Dockerfile
      args:
        NIXPACKS_METADATA: python,poetry
        NIXPACKS_POETRY_VERSION: 1.3.1
        PIP_DEFAULT_TIMEOUT: 100
        PIP_DISABLE_PIP_VERSION_CHECK: 1
        PIP_NO_CACHE_DIR: 1
        PYTHONDONTWRITEBYTECODE: 1
        PYTHONFAULTHANDLER: 1
        PYTHONHASHSEED: random
        PYTHONUNBUFFERED: 1
    ports:
      - "8000:8000"
    volumes:
      - ./services/api:/app
    environment:
      - PUBLIC_CRITINO_API_URL="http://0.0.0.0:7531"
      - PUBLIC_CRITINO_API_KEY
      - SUPABASE_URL
      - SUPABASE_ANON_KEY
      - SUPABASE_SERVICE_ROLE
      - REDDIT_CLIENT_ID
      - REDDIT_CLIENT_SECRET
      - REDDIT_USERNAME
      - REDDIT_PASSWORD
      - OPENAI_API_KEY
      - AZURE_API_KEY
      - LANGCHAIN_API_KEY
      - LANGCHAIN_TRACING_V2
      - LANGCHAIN_CALLBACKS_BACKGROUND
      - LANGCHAIN_PROJECT
      - LANGCHAIN_ENDPOINT
    env_file: ./services/api/.env
